#:kivy 1.9.0
#:import Factory kivy.factory.Factory



<FloatLayout>:
    canvas.before:
        Color:
            rgba: 0,0,0,.5
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'app_background.png' #just a placeholder to demonstrate we can use an image background; comment out above Color block to enable 
    
    Image:
        id: chart_image
        source: 'current_chart.png'
        size_hint: 0.55, 0.5
        pos_hint: {"top": 0.90, "right": 0.55}
        allow_stretch: True
        keep_ratio: False
    Label:
        text: "Financial Information"
        id: financials_text
        size_hint: 0.4, 0.05
        pos_hint: {"top": .88, "right": 0.98}
        font_size: "35sp"
        keep_ratio: True
        allow_stretch: True
    Image:
        id: financials_image
        source: "financial_data.png"
        size_hint: 0.40, 0.75
        pos_hint: {"top": 0.80, "right": 0.98}
        allow_stretch: True
        keep_ratio: False

    Button:
        text: "1d"
        size_hint: 0.05, 0.05
        pos_hint: {"top": 0.40, "right":.30}
        on_press: root.clicked_one_day_button()
    Button:
        text: "1mo"
        size_hint: 0.05, 0.05
        pos_hint: {"top": 0.40, "right":.35}
        on_press: root.clicked_one_month_button()
       
    Button:
        text: "6mo"
        size_hint: 0.05, 0.05
        pos_hint: {"top": 0.40, "right":.40}
        on_press: root.clicked_six_month_button()
    Button:
        text: "1yr"
        size_hint: 0.05, 0.05
        pos_hint: {"top": 0.40, "right":.45}
        on_press: root.clicked_one_year_button()
    Button:
        text: "5yr"
        size_hint: 0.05, 0.05
        pos_hint: {"top": 0.40, "right":.50}
        on_press: root.clicked_five_year_button()
    Button:
        text: "Max"
        size_hint: 0.05, 0.05
        pos_hint: {"top": 0.40, "right":.55}
        on_press: root.clicked_max_time_button()
    Button:
        text: "BUY STOCK"
        input_filter: "number"
        size_hint: 0.125, 0.05
        pos_hint: {"top": 0.35, "right":.125}
        color: 0, 0, 0, .85
        background_normal: ''
        background_color: .3, 1, .4, .85
        on_press: root.buyCallback()
    Button:
        text: "SELL STOCK"
        size_hint: 0.125, 0.05
        pos_hint: {"top": 0.35, "right":.25}
        color: 0, 0, 0, .85
        background_normal: ''
        background_color: 1, .3, .4, .85
        on_press: root.sellCallback()
    TextInput:
        id: Purchase
        pos_hint: {"top": 0.40, "right": .125}
        size_hint: 0.125, .05
        multiline: False
        on_text_validate: root.buyCallBack()
    TextInput:
        id: Sell
        pos_hint: {"top": 0.40, "right": .25}
        size_hint: 0.125,0.05
        multiline: False
    Label:
        text: "NEWS"
        pos_hint: {"top": 0.35, "right": 0.45}
        font_size: "20sp"
    Button:
        id: link0
        text: root.get_article_title(0)
        #text_size: root.get_window_size_percent_adjusted_width(0.55), root.get_window_size_percent_adjusted_height(0.05)
        halign: 'center'
        pos_hint: {"top": 0.15}
        size_hint: 0.55,0.05
        on_press: root.go_to_link0()
    Button:
        id: link1
        text: root.get_article_title(1)
        #text_size: root.get_window_size_percent_adjusted_width(0.55), root.get_window_size_percent_adjusted_height(0.05)
        halign: 'center'
        pos_hint: {"top": 0.10}
        size_hint: 0.55,0.05
        on_press: root.go_to_link1()
    Button:
        id: link2
        text: root.get_article_title(2)
        #text_size: root.get_window_size_percent_adjusted_width(0.55), root.get_window_size_percent_adjusted_height(0.05)
        halign: 'center'
        pos_hint: {"top": 0.05}
        size_hint: 0.55,0.05
        on_press: root.go_to_link2()
        border: 5,5,5,5
    Button:
        id: login_button
        text: "Log In"
        size_hint: 0.1, 0.05
        pos_hint: {"top":.95}
        color: 0, 0, 0, .8
        background_normal: ''
        background_color: 0, 1, 0, .85
        on_release: Factory.CustomPopup().open()
    Button:
        id: Welcome
        text: root.welcome()
        font_size: 18
        size_hint: 0.2, 0.04
        pos_hint: {"top":.95, "right": .65}
        color: 1, 1, 1, 1
        background_normal: ''
        background_color: 0, 0, 0, 1
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Line:
                width: 2
                rectangle: self.x, self.y, self.width, self.height
    Button:
        text: "Log Out"
        size_hint: 0.1, 0.05
        pos_hint: {"top":.95, "right": .4}
        color: 0, 0, 0, .85
        background_normal: ''
        background_color: 1, 0, 0, 1
        on_press: root.logout()
    Button:
        id: ticker_lookup
        text: "Look Up Ticker"
        size_hint: 0.1, 0.05
        pos_hint: {"top":.95, "right": .8}
        color: 1, 1, 1, .85
        background_normal: ''
        background_color: 0, 0, 1, .25
        on_release: Factory.TickerSearchPopup().open()
    Button:
        text: "Portfolio"
        size_hint: 0.1, 0.05
        pos_hint: {"top":.95, "right": 0.3}
        color: 176, 224, 230, .85
        background_color: 176, 224, 230, .85
        on_release: Factory.Portfolio().open()
    Button:
        text: "My Watch List"
        size_hint: 0.1, 0.05
        pos_hint: {"top":.95, "right": 0.2}
        color: 176, 224, 230, .85
        background_color: 176, 224, 230, .85
        on_release: Factory.WatchListPopup().open()
    CustomizedTextInput:
        id: input_field
        hint_text: 'Enter Stock Ticker Here'
        pos_hint: {"top": .95, "right": 1}
        size_hint: 0.2, 0.05
        multiline: False
        keyboard_suggestions: True
        #suggestion_text: 'test suggestion'
        on_text_validate: root.enter_stock_ticker()
    Button:
        id: live_price
        text: root.get_dict_value_as_string("Live Price: ", "regularMarketPrice")
        size_hint: 0.15, 0.05
        pos_hint: {"top": 0.35, "right":0.40}
        # background_normal: ''
        color: 1, 1, .3, 1
        # background_color: .2,.2,.2, 1
    Button:
        id: add_to_my_watch_list
        text: "Add to My Watch List"
        size_hint: 0.15, 0.05
        pos_hint: {"top": 0.35, "right": 0.55}
        on_press: root.add_to_my_watchlist()
    Button:
        id: mkt_cap
        text: root.get_dict_value_as_string("Market Cap: ", "marketCap")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.3, "right":.1375}
        on_press: root.setCurrentTooltip("Market Cap")
        on_release: Factory.TooltipPopup().open()
    Button:
        id: div_rate
        text: root.get_dict_value_as_string("Dividend Rate: ", "dividendRate")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.225, "right":.1375}
        on_press: root.setCurrentTooltip("Dividend Rate")
        on_release: Factory.TooltipPopup().open()  
    Button:
        id: fiftytwo_wk_high
        text: root.get_dict_value_as_string("52 Week High: ", "fiftyTwoWeekHigh")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.3, "right":.275}
        on_press: root.setCurrentTooltip("52 Week High")
        on_release: Factory.TooltipPopup().open()  
    Button:
        id: fiftytwo_wk_low
        text: root.get_dict_value_as_string("52 WeekLow: ", "fiftyTwoWeekLow")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.225, "right":.275}
        on_press: root.setCurrentTooltip("52 Week Low")
        on_release: Factory.TooltipPopup().open()  
    Button:
        id: trailing_pe
        text:root.get_dict_value_as_string("Trailing P/E: ", "trailingPE")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.3, "right":.4125}
        on_press: root.setCurrentTooltip("Trailing P/E")
        on_release: Factory.TooltipPopup().open()  
    Button:
        id: trailing_eps
        text: root.get_dict_value_as_string("Trailing EPS: ", "trailingEps")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.225, "right":.4125}
        on_press: root.setCurrentTooltip("Trailing EPS")
        on_release: Factory.TooltipPopup().open()  
    Button:
        id: beta
        text: root.get_dict_value_as_string("Beta: ", "beta")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.3, "right":.55}
        on_press: root.setCurrentTooltip("Beta")
        on_release: Factory.TooltipPopup().open()  
    Button:
        id: earn_growth
        text: root.get_dict_value_as_string( "Earnings Growth: ", "earningsQuarterlyGrowth")
        size_hint:0.1375, 0.075
        pos_hint: {"top": 0.225, "right":.55}
        on_press: root.setCurrentTooltip("Earnings Growth")
        on_release: Factory.TooltipPopup().open()  

<CustomPopup@Popup>:
    title: 'Login'
    id: popup
    auto_dismiss: False

    BoxLayout
        id: login_layout
        orientation: 'vertical'
        padding: [10,20,10,20]
        spacing: 10

        Label:
            text: 'Login Page'
            font_size: 28

        BoxLayout:
            orientation: 'vertical'

            Label:
                text: 'Username'
                font_size: 18
                halign: 'left'
                text_size: root.width-20, 20

            TextInput:
                id: login
                multiline:False
                font_size: 16

        BoxLayout:
            orientation: 'vertical'
            Label:
                text: 'Password'
                halign: 'left'
                font_size: 18
                text_size: root.width-20, 20

            TextInput:
                id: password
                multiline:False
                password:True
                font_size: 16

        Button:
            text: 'Login'
            font_size: 24
            on_press: root.login_btn(login.text, password.text)
            
        Button:
            text: 'Cancel'
            font_size: 24
            on_press: popup.dismiss()

        Button:
            text: 'Create Username'
            font_size: 24
            on_press: Factory.CreatePopup().open()

            
<CreatePopup@Popup>:
    title: 'Login'
    id: create
    auto_dismiss: False

    BoxLayout
        id: login_layout
        orientation: 'vertical'
        padding: [10,20,10,20]
        spacing: 10

        Label:
            text: 'Create Username'
            font_size: 28

        BoxLayout:
            orientation: 'vertical'

            Label:
                text: 'Username'
                font_size: 18
                halign: 'left'
                text_size: root.width-20, 20

            TextInput:
                id: createname
                multiline:False
                font_size: 16

        BoxLayout:
            orientation: 'vertical'

            Label:
                text: 'Email'
                font_size: 18
                halign: 'left'
                text_size: root.width-20, 20

            TextInput:
                id: email
                multiline:False
                font_size: 16        

        BoxLayout:
            orientation: 'vertical'
            Label:
                text: 'Password'
                halign: 'left'
                font_size: 18
                text_size: root.width-20, 20

            TextInput:
                id: createpass
                multiline:False
                font_size: 16

        Button:
            text: 'Create'
            font_size: 24
            on_press: root.create_login(createname.text, email.text, createpass.text)
            
        Button:
            text: 'Cancel'
            font_size: 24
            on_press: create.dismiss()

<Portfolio@Popup>:
    title: "Portfolio"

    GridLayout:
        cols: 4
        Button:
            text:"Stock Name"
        Button:
            text:"Shares"
        Button:
            text:"Current Price"
        Button:
            text:"Total Change"
        Label:
            text:"Apple"
        Label:
            text:"20"
        Label:
            text:"150"
        Label:
            text:"3000"

<MyPopup@Popup>:
    title: "Error Occured!"
    id: test_popup
    auto_dismiss: False
    size_hint: 0.40, 0.45
    pos_hint: {"top": 0.7, "right": 0.7}

    Button:
        text: "Error in retrieving this stock's information from YFinance! \n\n Make sure it is a valid stock ticker or try again later."
        on_release: test_popup.dismiss() 
        on_press: root.dismiss()

<TooltipPopup@Popup>:
    title: "MNMS Financial Dictionary"
    id: tooltip_popup
    auto_dismiss: False
    size_hint: 0.4, 0.4
    
    BoxLayout:
        id: tooltip_boxlayout
        orientation: 'vertical'

        Label:
            text: root.getCurrentTooltip()
            font_size: 28
            halign: 'center'
            size_hint: (1, .1)

        Label:
            text: root.getTooltipDefinition()
            halign: 'center'
            size_hint_y: None
            text_size: self.width, None
            height: self.texture_size[1]
            size_hint: (1, .75)
 
        Button:
            text: "Return"
            font_size: 16
            size_hint: (.3, .1)
            halign: 'left'
            on_press: root.dismiss()

<Purchase@Popup>:
    title: "Stocks Purchased"
    id: p_popup
    auto_dismiss: False
    size_hint: 0.40, 0.45
    pos_hint: {"top": 0.7, "right": 0.7}

    Button:
        text: "Stocks Successfully Purchased"
        on_release: p.dismiss() 
        on_press: root.dismiss()

<Sell@Popup>:
    title: "Stocks Sold"
    id: s_popup
    auto_dismiss: False
    size_hint: 0.40, 0.45
    pos_hint: {"top": 0.7, "right": 0.7}

    Button:
        text: "Stocks Successfully Sold"
        on_release: s_popup.dismiss() 
        on_press: root.dismiss()

<TickerSearchPopup@Popup>:
    title: 'Search for a Ticker'
    id: ticker_search_popup
    auto_dismiss: False
    size_hint: 0.6, 0.6

    BoxLayout:
        id: ticker_search_layout
        orientation: 'vertical'
        padding: [10,20,10,20]
        spacing: 10

        Label:
            text: 'Enter a Company Name or Partial Ticker'
            font_size: 18
            halign: 'center'
            size_hint: (1, .1)
            text_size: root.width-20, 20

        TextInput:
            id: ticker_search
            multiline:False
            font_size: 18
            size_hint: (1, .10)
            on_text_validate: root.enter_stock_search_string()
            halign: 'center'
        SearchResultRV:
            id: searched_stocks_rv
            size_hint: (1, .65)
            halign: 'center'

        Button:
            text: 'Cancel'
            font_size: 24
            size_hint: (.3, .1)
            halign: 'center'
            #on_press: root.login_btn(login.text, password.text)
            on_press: ticker_search_popup.dismiss()

<SearchResultRV>: 
    viewclass: 'SearchRVButton' 
    orientation: "vertical"
    spacing: 40
    padding:10, 10
    space_x: self.size[0]/3
  
    RecycleBoxLayout: 
        color:(0, 0.7, 0.4, 0.8) 
        default_size: None, dp(56) 
        default_size_hint: 1, None 
        size_hint_y: None
        height: self.minimum_height 
        orientation: 'vertical'

<WatchListPopup@Popup>:
    title: 'My Watch List'
    id: wl_popup
    auto_dismiss: False

    BoxLayout
        id: watch_list_layout
        orientation: 'vertical'
        padding: [10,20,10,20]
        spacing: 10

        Label:
            text: 'My Watch List'
            font_size: 18
            halign: 'center'
            size_hint: (1, .1)
            text_size: root.width-20, 20
        WatchListBox:
            id: watch_list_box
            size_hint: (1, .65)
            halign: 'center'
        Button:
            text: 'Cancel'
            font_size: 24
            size_hint: (.3, .1)
            on_press: wl_popup.dismiss()

<WatchListBox>: 
    viewclass: "WLButton" 
    orientation: "vertical"
    spacing: 40
    padding:10, 10
    space_x: self.size[0]/3

    RecycleBoxLayout: 
        color:(0, 0.7, 0.4, 0.8) 
        default_size: None, dp(100) 
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height 
        orientation: 'vertical'